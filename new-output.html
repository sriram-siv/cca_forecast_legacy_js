<!DOCTYPE html>
<!-- saved from url=(0067)file:///Users/sriramsivarajah/Dev/cca_forecast_legacy_js/index.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Forecast Summary</title>
</head>

<body onload="main()">
    <div id="forecast-summaries">
        <div>
            <h3>Day: Sunday, 18 February</h3>
            <p>Morning Average Temperature: 9.83</p>
            <p>Morning Chance Of Rain: 0.14%</p>
            <p>Afternoon Average Temperature: 16.17</p>
            <p>Afternoon Chance Of Rain: 0.40%</p>
            <p>High Temperature: 17</p>
            <p>Low Temperature: 6</p>
        </div>
        <div>
            <h3>Day: Monday, 19 February</h3>
            <p>Morning Average Temperature: 9.83</p>
            <p>Morning Chance Of Rain: 0.14%</p>
            <p>Afternoon Average Temperature: 16.17</p>
            <p>Afternoon Chance Of Rain: 0.40%</p>
            <p>High Temperature: 17</p>
            <p>Low Temperature: 6</p>
        </div>
        <div>
            <h3>Day: Tuesday, 20 February</h3>
            <p>Morning Average Temperature: 9.83</p>
            <p>Morning Chance Of Rain: 0.14%</p>
            <p>Afternoon Average Temperature: 16.17</p>
            <p>Afternoon Chance Of Rain: 0.40%</p>
            <p>High Temperature: 17</p>
            <p>Low Temperature: 6</p>
        </div>
    </div>

    <script>
        async function fetchData() {
            // Fetch data from url
            const url = "https://e75urw7oieiszbzws4gevjwvze0baaet.lambda-url.eu-west-2.on.aws/";
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const weatherData = await response.json();

            return weatherData;
        }

        async function main() {
            try {
                const weatherData = await fetchData();

                // Process data
                const groupedData = weatherData.reduce((acc, entry) => {
                    const entryDate = new Date(entry.date_time);
                    const dayKey = entryDate.toISOString().split('T')[0];
                    if (!acc[dayKey]) {
                        acc[dayKey] = [];
                    }
                    acc[dayKey].push(entry);
                    return acc;
                }, {});

                const container = document.getElementById('forecast-summaries');
                Object.entries(groupedData).forEach(([day, entries]) => {
                    const allTemps = entries.map(entry => entry.average_temperature);
                    const morningEntries = entries.filter(entry => {
                        const hour = new Date(entry.date_time).getHours();
                        return hour >= 6 && hour < 12;
                    });
                    const afternoonEntries = entries.filter(entry => {
                        const hour = new Date(entry.date_time).getHours();
                        return hour >= 12 && hour < 18;
                    });

                    const morningTemps = morningEntries.map(entry => entry.average_temperature);
                    const morningRains = morningEntries.map(entry => entry.probability_of_rain);
                    const afternoonTemps = afternoonEntries.map(entry => entry.average_temperature);
                    const afternoonRains = afternoonEntries.map(entry => entry.probability_of_rain);

                    const summaryElement = document.createElement('div');
                    summaryElement.innerHTML = `
                    <h3>Day: ${new Date(day).toLocaleDateString(undefined, {
                        weekday: 'long',
                        month: 'long',
                        day: 'numeric'
                    })}</h3>
                    <p>Morning Average Temperature: ${morningTemps.length ? (morningTemps.reduce((a, b) => a + b, 0) / morningTemps.length).toFixed(2) : 'Insufficient forecast data'}</p>
                    <p>Morning Chance Of Rain: ${morningRains.length ? (morningRains.reduce((a, b) => a + b, 0) / morningRains.length).toFixed(2) + '%' : 'Insufficient forecast data'}</p>
                    <p>Afternoon Average Temperature: ${afternoonTemps.length ? (afternoonTemps.reduce((a, b) => a + b, 0) / afternoonTemps.length).toFixed(2) : 'Insufficient forecast data'}</p>
                    <p>Afternoon Chance Of Rain: ${afternoonRains.length ? (afternoonRains.reduce((a, b) => a + b, 0) / afternoonRains.length).toFixed(2) + '%' : 'Insufficient forecast data'}</p>
                    <p>High Temperature: ${Math.max(...allTemps)}</p>
                    <p>Low Temperature: ${Math.min(...allTemps)}</p>
                `;
                    container.appendChild(summaryElement);
                });
            } catch (error) {
                console.error('Failed to fetch weather data:', error);
            }
        }
    </script>


</body>

</html>